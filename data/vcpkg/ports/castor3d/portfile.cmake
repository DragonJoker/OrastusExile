vcpkg_check_linkage(ONLY_DYNAMIC_LIBRARY)

vcpkg_from_github(
    OUT_SOURCE_PATH SOURCE_PATH
    REPO DragonJoker/Castor3D
    REF 10ce51ce2ee7144832c14f7a37cae1996d4e01ab
    HEAD_REF master
    SHA512 a43fe8329ae56e6d9529a2422129040614bd88bf95df16169f3a107b1c461aea51abf1618dca90eb3e9a8db00e28331deab1879d8cad7ba71bc9741d53bf8f70
    PATCHES fix.patch
)

vcpkg_from_github(OUT_SOURCE_PATH CMAKE_SOURCE_PATH
    REPO DragonJoker/CMakeUtils
    REF 3d1c70db97f31530f9ca88052797047d419ea96c
    HEAD_REF master
    SHA512 018b53745661fa0251292fc8948783cce72072f62af9187c41a3476c01b30b67f99889e6babeab334d7e82f871661f239961af3f1e46ed71fcfe676934c93c1d
    PATCHES vcpkg_modules.patch
)

file(REMOVE_RECURSE "${SOURCE_PATH}/CMake")
file(COPY "${CMAKE_SOURCE_PATH}/" DESTINATION "${SOURCE_PATH}/CMake")

vcpkg_check_features(OUT_FEATURE_OPTIONS FEATURE_OPTIONS
    FEATURES
        assimp     CASTOR_BUILD_IMPORTER_ASSIMP
        freeimage  CASTOR_USE_FREEIMAGE
        glsl       CASTOR_C3D_NEEDS_GLSL
        gltf       CASTOR_BUILD_IMPORTER_GLTF
        vkfft      CASTOR_HAS_VKFFT
)

vcpkg_cmake_configure(
    SOURCE_PATH ${SOURCE_PATH}
    OPTIONS
        -DCASTOR_BUILD_PLUGINS=ON
        -DCASTOR_BUILDGRP_DEMO=OFF
        -DCASTOR_BUILDGRP_INTEROP=OFF
        -DCASTOR_BUILDGRP_TEST=OFF
        -DCASTOR_BUILDGRP_TOOL=OFF
        -DCASTOR_FORCE_VCPKG_SUBMODULES=ON
        -DCASTOR_USE_GLSLANG=ON
        -DCASTOR_USE_MESH_SHADERS=OFF
        -DCASTOR_USE_TASK_SHADERS=OFF
        -DPROJECTS_UNITY_BUILD=ON
        -DPROJECTS_USE_PRECOMPILED_HEADERS=OFF
        -DVCPKG_BUILD=ON
        ${FEATURE_OPTIONS}
)

vcpkg_copy_pdbs()
vcpkg_cmake_install()
vcpkg_cmake_config_fixup(CONFIG_PATH lib/cmake/Castor3D)

file(REMOVE_RECURSE "${CURRENT_PACKAGES_DIR}/debug/include")
file(REMOVE_RECURSE "${CURRENT_PACKAGES_DIR}/debug/share")
file(INSTALL ${SOURCE_PATH}/LICENSE DESTINATION ${CURRENT_PACKAGES_DIR}/share/${PORT} RENAME copyright)
